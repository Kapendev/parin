#!/bin/env sh

extra_flags=''
source_path=source
exe_path=./app
can_package_include=1
parin_package_path=./parin_package
joka_package_path=./joka_package
compiler=dmd
version=linux_x86_64

[ -n "$1" ] && compiler=$1
[ -n "$2" ] && version=$2

# Find the source folder.
app_path=$source_path/app.d
if [ ! -d "$source_path" ]; then
    source_path=src
    app_path=$source_path/app.d
fi
if [ ! -d "$source_path" ]; then
    source_path=.
    app_path=$source_path/app.d
fi

# Include from packages if needed.
package_include=''
[ "$can_package_include" = 1 ] \
    && [ ! -d $source_path/parin ] \
    && package_include="-I=$parin_package_path/source -I=$joka_package_path/source" \
    && echo "Building with: $package_include"

# Run the thing.
$compiler \
    -of=$exe_path -i \
    -L=-L$parin_package_path/vendor/$version \
    -J=$parin_package_path/source/parin -J=./assets \
    -I=$source_path $package_include \
    $extra_flags -run $app_path
